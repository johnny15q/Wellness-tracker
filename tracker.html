<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Fitness & Diet Tracker</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
  <style>
    /* Palette from user: #0a090c (dark), #f6f5f7 (light), #7d7292, #beaabb, #b19aa7 */
    :root{
      --bg:#0a090c; --panel:#0f0d10; --card:#121017; --muted:#9da0ad; --text:#f6f5f7;
      --accent:#7d7292; --accent-2:#beaabb; --accent-3:#b19aa7;
      --glass: rgba(246,245,247,0.03);
      --success:#22c55e;
      --shadow: 0 8px 24px rgba(2,4,10,0.6);
    }
    body.light{
      --bg:#f6f5f7; --panel:#ffffff; --card:#fbfbfc; --muted:#5b5a66; --text:#0a090c; --glass: rgba(10,9,12,0.03);
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial;background:linear-gradient(180deg,var(--bg),#081018 100%);color:var(--text);-webkit-font-smoothing:antialiased}

    .wrap{max-width:1200px;margin:26px auto;padding:18px}
    header{display:flex;align-items:center;justify-content:space-between;margin-bottom:18px}
    h1{margin:0;font-size:20px;font-weight:600}
    .controls{display:flex;gap:8px;align-items:center}
    .btn{border:0;padding:8px 12px;border-radius:10px;cursor:pointer;font-weight:600}
    .ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--text)}
    .accent{background:linear-gradient(90deg,var(--accent),var(--accent-2));color:var(--text)}
    .grid{display:grid;grid-template-columns:360px 1fr 300px;gap:18px}

    .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent);border:1px solid rgba(255,255,255,0.04);padding:14px;border-radius:12px;box-shadow:var(--shadow)}
    label{display:block;font-size:12px;color:var(--muted);margin-bottom:6px}
    input[type=text], input[type=number], select, textarea, input[type=date], input[type=time]{width:100%;padding:9px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:var(--text);font-size:14px}
    select{appearance:none}
    .row{display:flex;gap:10px}
    .row>*{flex:1}
    .small{font-size:12px;color:var(--muted)}

    h2{margin:0 0 8px 0;font-size:15px;color:var(--accent)}
    .list{max-height:220px;overflow:auto;margin-top:8px}
    .entry{display:flex;justify-content:space-between;padding:8px;border-radius:8px;background:var(--glass);margin-bottom:8px}

    .stats{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:12px}
    .stat{flex:1;min-width:120px;padding:10px;border-radius:10px;background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);}

    canvas{width:100%;height:150px;background:transparent;border-radius:8px}
    footer{margin-top:14px;color:var(--muted);font-size:12px;text-align:center}

    /* Right panel recent */
    .recent-panel{display:flex;flex-direction:column;gap:12px}
    .recent-section{background:linear-gradient(180deg,rgba(255,255,255,0.015),transparent);padding:10px;border-radius:10px}
    .recent-list{max-height:160px;overflow:hidden;transition:max-height .35s ease}
    .show-toggle{background:transparent;border:0;color:var(--accent);cursor:pointer;padding:6px 8px;font-weight:600}

    /* Responsive */
    @media(max-width:1080px){.grid{grid-template-columns:320px 1fr 300px;gap:14px}}
    @media(max-width:920px){.grid{grid-template-columns:1fr;}
      .wrap{padding:12px}
      .recent-list{max-height:160px}
    }

    /* icons brighter */
    .icon{filter:brightness(2.6) saturate(1.1)}

  </style>
</head>
<body>
  <div class="wrap" id="appWrap">
    <header>
      <div style="display:flex;flex-direction:column">
        <h1>Fitness & Diet Tracker</h1>
        <div class="small">Logs workouts, tracks meals, converts kJ → kcal automatically</div>
      </div>
      <div class="controls">
        <button id="themeBtn" class="btn ghost">Toggle Theme</button>
        <button id="exportBtn" class="btn ghost">Export JSON</button>
        <button id="importBtn" class="btn ghost">Import JSON</button>
      </div>
    </header>

    <div class="grid">
      <!-- left column: inputs -->
      <div>
        <div class="card" id="workoutCard">
          <h2>Log Workout</h2>
          <label>Exercise</label>
          <input type="text" id="workoutName" placeholder="e.g. Running" />
          <div class="row" style="margin-top:8px">
            <div>
              <label>Duration (mins)</label>
              <input type="number" id="workoutDuration" min="0" />
            </div>
            <div>
              <label>Calories burned (kcal)</label>
              <input type="number" id="workoutCalories" min="0" />
            </div>
          </div>
          <div style="margin-top:8px" class="row">
            <div>
              <label>Date</label>
              <input type="date" id="workoutDate" />
            </div>
            <div>
              <label>Time</label>
              <input type="time" id="workoutTime" />
            </div>
          </div>
          <div style="margin-top:10px;display:flex;gap:8px">
            <button id="addWorkout" class="btn accent">Add Workout</button>
            <button id="clearWorkouts" class="btn ghost">Clear</button>
          </div>
        </div>

        <div class="card" style="margin-top:14px" id="dietCard">
          <h2>Log Food / Meal</h2>
          <label>Food / Meal</label>
          <input type="text" id="foodName" placeholder="e.g. Chicken salad" />
          <div class="row" style="margin-top:8px">
            <div>
              <label>Energy value</label>
              <input type="number" id="foodEnergy" min="0" placeholder="e.g. 500" />
            </div>
            <div>
              <label>Unit</label>
              <select id="foodUnit"><option value="kcal">kcal</option><option value="kJ">kJ</option></select>
            </div>
          </div>
          <div style="margin-top:8px" class="row">
            <div>
              <label>Date</label>
              <input type="date" id="foodDate" />
            </div>
            <div>
              <label>Meal</label>
              <select id="foodMeal"><option>Breakfast</option><option>Lunch</option><option>Dinner</option><option>Snack</option></select>
            </div>
          </div>
          <div style="margin-top:10px;display:flex;gap:8px">
            <button id="addFood" class="btn accent">Add Food</button>
            <button id="clearFood" class="btn ghost">Clear</button>
          </div>
        </div>
      </div>

      <!-- middle column: summary + charts -->
      <div>
        <div class="card">
          <h2>Summary</h2>
          <div class="stats" style="margin-bottom:12px">
            <div class="stat"><div class="small">Calories In (today)</div><div id="calIn" style="font-size:18px">0 kcal</div></div>
            <div class="stat"><div class="small">Calories Out (today)</div><div id="calOut" style="font-size:18px">0 kcal</div></div>
            <div class="stat"><div class="small">Net Calories (today)</div><div id="calNet" style="font-size:18px">0 kcal</div></div>
            <div class="stat"><div class="small">7-day Total Net</div><div id="weekNet" style="font-size:18px">0 kcal</div></div>
          </div>

          <h2 style="margin-top:6px">7-Day Calories</h2>
          <canvas id="chartCalories" width="600" height="150"></canvas>

          <h2 style="margin-top:6px">7-Day Workouts</h2>
          <canvas id="chartWorkouts" width="600" height="150"></canvas>

          <div style="display:flex;gap:8px;margin-top:12px">
            <button id="exportCSV" class="btn ghost">Export CSV (today)</button>
            <button id="resetAll" class="btn" style="background:linear-gradient(90deg,var(--accent-2),var(--accent-3));">Reset All</button>
          </div>
        </div>
      </div>

      <!-- right column: recents -->
      <div>
        <div class="card recent-panel">
          <h2>Recent (quick)</h2>
          <div class="recent-section">
            <div style="display:flex;justify-content:space-between;align-items:center"><div><strong>Recent Foods</strong><div class="small">latest 5</div></div></div>
            <div id="foodList" class="recent-list"></div>
            <div style="text-align:right"><button id="foodShowMore" class="show-toggle">Show More</button></div>
          </div>

          <div class="recent-section">
            <div style="display:flex;justify-content:space-between;align-items:center"><div><strong>Recent Workouts</strong><div class="small">latest 5</div></div></div>
            <div id="workoutList" class="recent-list"></div>
            <div style="text-align:right"><button id="workoutShowMore" class="show-toggle">Show More</button></div>
          </div>

          <div class="recent-section">
            <div style="display:flex;justify-content:space-between;align-items:center"><div><strong>Tools</strong></div></div>
            <div style="display:flex;gap:8px;margin-top:8px"><button id="importBtn2" class="btn ghost">Import</button><button id="exportBtn2" class="btn ghost">Export</button></div>
            <div class="small" style="margin-top:8px">Data saved locally (localStorage). Use Export/Import to move between devices.</div>
          </div>
        </div>
      </div>
    </div>

    <footer>Tip: enter energy in kJ or kcal — the app converts kJ → kcal automatically (1 kcal = 4.184 kJ).</footer>
  </div>

<script>
(() => {
  const KJ_TO_KCAL = 1/4.184;
  const $ = id => document.getElementById(id);
  const todayISO = (d=new Date())=>d.toISOString().slice(0,10);
  const LS_KEY = 'fd_tracker_v3';
  let state = {workouts:[], foods:[]};

  // init
  $('workoutDate').value = todayISO();
  $('foodDate').value = todayISO();

  function load(){ try{ const raw = localStorage.getItem(LS_KEY); if(raw) state = JSON.parse(raw); }catch(e){console.error(e)} }
  function save(){ localStorage.setItem(LS_KEY, JSON.stringify(state)); }

  // add handlers
  $('addWorkout').addEventListener('click', ()=>{
    const name = $('workoutName').value.trim();
    const duration = Number($('workoutDuration').value) || 0;
    const calories = Number($('workoutCalories').value) || 0;
    const date = $('workoutDate').value || todayISO();
    const time = $('workoutTime').value || '';
    if(!name){ alert('Please enter an exercise name'); return }
    state.workouts.unshift({id:Date.now(),name,duration,calories,date,time}); save(); renderAll(); clearWorkoutInputs();
  });
  $('clearWorkouts').addEventListener('click', ()=>{ if(confirm('Clear all workouts?')){ state.workouts=[]; save(); renderAll(); } });

  $('addFood').addEventListener('click', ()=>{
    const name = $('foodName').value.trim();
    let value = Number($('foodEnergy').value) || 0;
    const unit = $('foodUnit').value; const date = $('foodDate').value || todayISO(); const meal = $('foodMeal').value;
    if(!name){ alert('Please enter a food/meal name'); return }
    let kcal = unit === 'kJ' ? value * KJ_TO_KCAL : value; kcal = Math.round(kcal*10)/10;
    state.foods.unshift({id:Date.now(),name,kcal,raw:value,unit,date,meal}); save(); renderAll(); clearFoodInputs();
  });
  $('clearFood').addEventListener('click', ()=>{ if(confirm('Clear all foods?')){ state.foods=[]; save(); renderAll(); } });

  // import/export
  function exportJSON(){ const data = JSON.stringify(state,null,2); const blob = new Blob([data],{type:'application/json'}); const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.href=url; a.download='fd-tracker-data.json'; a.click(); URL.revokeObjectURL(url); }
  function importJSON(file){ const reader = new FileReader(); reader.onload = e => { try{ const parsed = JSON.parse(e.target.result); if(parsed.foods && parsed.workouts){ state = parsed; save(); renderAll(); alert('Imported successfully'); } else alert('Invalid file'); }catch(err){ alert('Import failed: '+err.message) } }; reader.readAsText(file); }
  $('exportBtn').addEventListener('click', exportJSON); $('exportBtn2').addEventListener('click', exportJSON);
  $('importBtn').addEventListener('click', ()=>{ const t = document.createElement('input'); t.type='file'; t.accept='.json'; t.onchange = e => { const f = e.target.files[0]; if(f) importJSON(f); }; t.click(); });
  $('importBtn2').addEventListener('click', ()=>{ const t = document.createElement('input'); t.type='file'; t.accept='.json'; t.onchange = e => { const f = e.target.files[0]; if(f) importJSON(f); }; t.click(); });

  // CSV export
  $('exportCSV').addEventListener('click', ()=>{
    const day = todayISO(); const foods = state.foods.filter(f=>f.date===day); const workouts = state.workouts.filter(w=>w.date===day);
    let csv = 'type,name,meal_or_duration,energy_kcal,date\n';
    foods.forEach(f=> csv += `food,${escapeCSV(f.name)},${f.meal},${f.kcal},${f.date}\n`);
    workouts.forEach(w=> csv += `workout,${escapeCSV(w.name)},${w.duration},${w.calories},${w.date}\n`);
    const blob = new Blob([csv],{type:'text/csv'}); const url = URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download='fd-day.csv'; a.click(); URL.revokeObjectURL(url);
  });
  function escapeCSV(s){ if(typeof s!=='string') return s; if(s.includes(',')||s.includes('"')||s.includes('\n')) return '"'+s.replace(/"/g,'""')+'"'; return s }

  $('resetAll').addEventListener('click', ()=>{ if(confirm('Delete all data permanently?')){ state = {workouts:[], foods:[]}; save(); renderAll(); alert('Data reset'); } });

  function clearWorkoutInputs(){ $('workoutName').value=''; $('workoutDuration').value=''; $('workoutCalories').value=''; $('workoutTime').value=''; }
  function clearFoodInputs(){ $('foodName').value=''; $('foodEnergy').value=''; $('foodUnit').value='kcal'; }

  // render
  function renderWorkouts(limit=5){ const el = $('workoutList'); el.innerHTML=''; state.workouts.slice(0,limit).forEach(w=>{ const d = document.createElement('div'); d.className='entry'; d.innerHTML = `<div><div style='font-weight:600'>${escapeHtml(w.name)}</div><div class='small'>${w.date} ${w.time} • ${w.duration} min</div></div><div style='text-align:right'><div style='font-weight:700'>${w.calories} kcal</div></div>`; el.appendChild(d); }); }
  function renderFoods(limit=5){ const el = $('foodList'); el.innerHTML=''; state.foods.slice(0,limit).forEach(f=>{ const d = document.createElement('div'); d.className='entry'; d.innerHTML = `<div><div style='font-weight:600'>${escapeHtml(f.name)}</div><div class='small'>${f.date} • ${f.meal} • <span title='raw'>${f.raw}${f.unit}</span></div></div><div style='text-align:right'><div style='font-weight:700'>${f.kcal} kcal</div></div>`; el.appendChild(d); }); }
  function escapeHtml(s){ return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;') }

  function getTotalsForDate(date){ const ins = state.foods.filter(f=>f.date===date).reduce((a,b)=>a+b.kcal,0); const outs = state.workouts.filter(w=>w.date===date).reduce((a,b)=>a+b.calories,0); return {ins: Math.round(ins*10)/10, outs: Math.round(outs*10)/10, net: Math.round((ins-outs)*10)/10}; }

  function renderSummary(){ const day = todayISO(); const t = getTotalsForDate(day); $('calIn').innerText = `${t.ins} kcal`; $('calOut').innerText = `${t.outs} kcal`; $('calNet').innerText = `${t.net} kcal`; const last7 = lastNDates(7); let weekNet=0; last7.forEach(d=>{ const u = getTotalsForDate(d); weekNet+=u.net }); $('weekNet').innerText = `${Math.round(weekNet*10)/10} kcal`; }

  function lastNDates(n){ const arr=[]; for(let i=n-1;i>=0;i--){ const d = new Date(); d.setDate(d.getDate()-i); arr.push(d.toISOString().slice(0,10)); } return arr }

  // charts (simple canvas bars)
  const cCal = $('chartCalories').getContext('2d'); const cWk = $('chartWorkouts').getContext('2d');
  function drawCharts(){ const days = lastNDates(7); const ins = days.map(d=>state.foods.filter(f=>f.date===d).reduce((a,b)=>a+b.kcal,0)); const outs = days.map(d=>state.workouts.filter(w=>w.date===d).reduce((a,b)=>a+b.calories,0)); drawBar(cCal, days, ins, getComputedStyle(document.documentElement).getPropertyValue('--accent') || '#7d7292'); drawBar(cWk, days, outs, getComputedStyle(document.documentElement).getPropertyValue('--accent-2') || '#beaabb'); }
  function drawBar(ctx, days, data, color){ const canvas = ctx.canvas; ctx.clearRect(0,0,canvas.width,canvas.height); const max = Math.max(...data, 100); ctx.lineWidth=1; ctx.strokeStyle='rgba(255,255,255,0.04)'; for(let i=0;i<4;i++){ const y = (canvas.height/4)*i; ctx.beginPath(); ctx.moveTo(0,y); ctx.lineTo(canvas.width,y); ctx.stroke(); } const pad=18; const w = (canvas.width - pad*2)/days.length; const barW = Math.min(w*0.6,40); days.forEach((d,i)=>{ const x = pad + i*w; const h = (data[i]/max)*(canvas.height-30); ctx.fillStyle = color.trim(); ctx.fillRect(x + (w-barW)/2, canvas.height - h - 10, barW, h); ctx.fillStyle = 'rgba(246,245,247,0.9)'; ctx.font='11px Inter, Arial'; ctx.textAlign='center'; ctx.fillText(d.slice(5), x + w/2, canvas.height-2); }); }

  // show more toggles
  let foodExpanded=false; let wkExpanded=false;
  function updateRecents(){ renderFoods(foodExpanded?state.foods.length:5); renderWorkouts(wkExpanded?state.workouts.length:5); }
  $('foodShowMore').addEventListener('click', ()=>{ foodExpanded = !foodExpanded; $('foodShowMore').innerText = foodExpanded ? 'Show Less' : 'Show More'; updateRecents(); $('foodList').style.maxHeight = foodExpanded ? '500px' : '160px'; });
  $('workoutShowMore').addEventListener('click', ()=>{ wkExpanded = !wkExpanded; $('workoutShowMore').innerText = wkExpanded ? 'Show Less' : 'Show More'; updateRecents(); $('workoutList').style.maxHeight = wkExpanded ? '500px' : '160px'; });

  // theme toggle
  const body = document.body; const themeBtn = $('themeBtn'); function applyTheme(theme){ if(theme==='light'){ body.classList.add('light'); } else { body.classList.remove('light'); } localStorage.setItem('fd_theme', theme); }
  themeBtn.addEventListener('click', ()=>{ applyTheme(body.classList.contains('light') ? 'dark' : 'light'); });
  const savedTheme = localStorage.getItem('fd_theme') || 'dark'; applyTheme(savedTheme);

  // initial load & render
  load(); function renderAll(){ renderSummary(); drawCharts(); updateRecents(); }
  renderAll();

})();
</script>
</body>
</html>
